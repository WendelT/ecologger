<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
    <!--<script type="text/javascript" src="js/chart.min.js"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.0.0/Chart.min.js" ></script>
    
    
    <title>Document</title>
</head>
<body>
    <h1>Teste de Gráfico</h1>
    <h2>up_tese_graph_29</h2>
    <div class="myChartDiv">
      <canvas id="myChart" width="600" height="400"></canvas> 
    </div>
    <form name="myForm" method="post" onsubmit="return savedata()">
        <input type="text" name="nome" id="cl" placeholder="Id Cliente"/>
        <select id="variablePosition">
            <option id="barGraph" value="5">Energia</option>
            <option id="lineGraph" value="2">Potência</option>
        </select>
        <input type="date" name="data_inicial" id="dt1" placeholder="Start Date"/>
        <input type="date" name="data_final" id="dt2" placeholder="Final Date"/>
        <input type="time" name="time1" id="tm1" step="1"/>
        <input type="time" name="time2" id="tm2" step="1"/>
        <input type="submit" id="update" name="submit" value="Modificar" />
        
    </form>
    <p>Tipo :  <span id="ener"></span></p>

    <script>
      
      function savedata() { 
        var data = document.getElementById("dt1");
        var data2 = document.getElementById("dt2");
        var time1 = document.getElementById("tm1");
        var time2 = document.getElementById("tm2");
        var client = document.getElementById("cl");
        var type = document.getElementById("variablePosition");
        
        console.log( document.getElementById("dt1").value);
        console.log( document.getElementById("dt2").value);
        console.log( document.getElementById("tm1").value);
        console.log( document.getElementById("tm2").value);
        console.log( document.getElementById("variablePosition").value);
        sessionStorage.setItem("cl", client.value);
        sessionStorage.setItem("dt1", data.value);
        sessionStorage.setItem("dt2", data2.value);
        sessionStorage.setItem("tm1", time1.value);
        sessionStorage.setItem("tm2", time2.value);
        sessionStorage.setItem("variablePosition", type.value);

        
        return true;
      }
      var th = sessionStorage.getItem("variablePosition");
      console.log(th);
      console.log(tm2.value);
    
      document.getElementById("ener").innerHTML = th;
      
      let url1 = "http://ecologger.eng.br/graph_total/data.php?nome=" + sessionStorage.getItem("cl") + "&data_inicial=" + sessionStorage.getItem("dt1") + "&data_final=" + sessionStorage.getItem("dt2") + "&time1=" + sessionStorage.getItem("tm1") + "&time2=" + sessionStorage.getItem("tm2")+"&position=" + sessionStorage.getItem("variablePosition")+"&";
    //let url1 = "http://ecologger.eng.br/graph_line/data.php?nome=lorena&data_inicial=2021-07-27&data_final=2021-07-28&time1=02:00:00&time2=05:00:45";
      console.log( url1.value);
      $(document).ready(function () {
            createGraph();
      });
        
      function createGraph()
          {
            {
              $.get(url1,
                function (data)
                {
                  
                    
                  
                  console.log(data);
                  var id = [];
                  var ener = [];

                  for (var i in data) {
                   // var x = 'DATE';
                    
                      id.push(data[i].x);
                      ener.push(data[i].y);
                    
                    
                  }
                  var dados = {
                    labels: id,
                    datasets: [
                      {
                        label: 'Energia',
                        backgroundColor: '#3DDC97',
                        borderColor: '#46d5f1',
                        hoverBackgroundColor: '#CCCCCC',
                        hoverBorderColor: '#666666',
                        data: ener
                      }
                    ]
                  };

                  var gTarget = $("#myChart");
                  var myChart = new Chart(gTarget, {
                      type: 'line',
                      data: dados,
                      options: {
            responsive: true,
            title:{
                display: true,
                text:'Chart.js Bubble Chart'
            },
            scales: {
                xAxes: [{
                    type: 'time',
                    
                    time: {
                        format: 'HH:mm',
                        tooltipFormat: 'HH:mm',
                        unit: 'minute',
                        stepSize: 15,
                        displayFormats: {
                            'minute': 'HH:mm',
                            'hour': 'HH:mm'
                        }
                    }
                }]
            }
        }
                      
                        
                      
                  });
                  
                });
              } 
                   
            }
        
          
          
          /*document.getElementById('changeToLine').onclick = function() {
            myChart.destroy();
            myChart = new Chart(ctx, {
              type: 'line',
              data: chartData
            });
          };*/
          

          
   /*$(document).ready(function(){
                $('#changeToLine').change(function () {
                    var job =  $('#changeToLine').val();
                    //alert(job);
                    if(job=="line"){
                        myChart.destroy();
                        myChart = new Chart(ctx, {
                        type: 'line',
                        data: chartData
                        });
                    }
                    else{
                        myChart.destroy();
                        myChart = new Chart(ctx, {
                        type: 'bar',
                        data: chartData
                        });
                    }
                })
            });*/
            
    </script>
</body>
</html>